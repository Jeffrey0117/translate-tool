<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>æ™®æ‹‰æ–‡ç« ä¸Šå‚³åŠ©æ‰‹</title>
    <style>
      body {
        font-family: sans-serif;
        background: #f9fafb;
        padding: 20px;
        color: #333;
      }
      h1 {
        color: #1d4ed8;
      }
      h2 {
        margin-top: 30px;
        color: #1d4ed8;
      }
      .section {
        margin-bottom: 30px;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      .drop-zone {
        border: 2px dashed #1d4ed8;
        border-radius: 8px;
        padding: 30px;
        text-align: center;
        color: #555;
        margin: 20px 0;
        background: #f0f9ff;
        cursor: pointer;
      }
      canvas {
        border: 1px solid #ccc;
        margin: 10px;
        max-width: 100%;
      }
      .options label {
        margin-right: 20px;
        cursor: pointer;
      }
      textarea {
        width: 100%;
        height: 140px;
        font-size: 14px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .textarea-block {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
      }
      .btn {
        padding: 8px 14px;
        margin: 5px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
      }
      .blue-btn {
        background: #1d4ed8;
        color: #fff;
      }
      .yellow-btn {
        background: #fde047;
        color: #000;
      }
      .pulse {
        animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(29, 78, 216, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(29, 78, 216, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(29, 78, 216, 0);
        }
      }
    </style>
  </head>
  <body>
    <h1>æ™®æ‹‰æ–‡ç« ä¸Šå‚³åŠ©æ‰‹</h1>

    <!-- API Key -->
    <div class="section">
      <label>ğŸ”‘ OpenAI API Keyï¼š</label>
      <input
        type="password"
        id="apiKey"
        placeholder="è¼¸å…¥ä½ çš„ API Key"
        style="width: 300px; padding: 5px"
      />
      <button class="btn yellow-btn" id="saveKey">å„²å­˜</button>
      <button class="btn yellow-btn" id="loadKey">è¼‰å…¥</button>
      <button class="btn yellow-btn" id="toggleKey">é¡¯ç¤º/éš±è—</button>
    </div>

    <!-- æ–‡ç« ç¿»è­¯åŠ©æ‰‹ -->
    <div class="section">
      <h2>æ–‡ç« ç¿»è­¯åŠ©æ‰‹</h2>
      <textarea id="inputText" placeholder="è¼¸å…¥ç¹é«”ä¸­æ–‡æ–‡ç« "></textarea>
      <div>
        <button class="btn blue-btn pulse" id="translateSimplifiedBtn">
          ç¿»è­¯æˆç°¡é«”
        </button>
        <button class="btn blue-btn pulse" id="translateEnglishBtn">
          ç¿»è­¯æˆè‹±æ–‡
        </button>
      </div>
      <div class="textarea-block">
        <textarea id="simplifiedText" placeholder="ç°¡é«”ç¿»è­¯çµæœ"></textarea>
        <button class="btn yellow-btn" onclick="copyText('simplifiedText')">
          Copy
        </button>
      </div>
      <div class="textarea-block">
        <textarea id="englishText" placeholder="è‹±æ–‡ç¿»è­¯çµæœ"></textarea>
        <button class="btn yellow-btn" onclick="copyText('englishText')">
          Copy
        </button>
      </div>
    </div>

    <script>
      // ====== API Key ç®¡ç† ======
      const apiKeyInput = document.getElementById("apiKey");

      document.getElementById("saveKey").addEventListener("click", () => {
        localStorage.setItem("openai_api_key", apiKeyInput.value.trim());
        alert("âœ… API Key å·²å„²å­˜");
      });

      document.getElementById("loadKey").addEventListener("click", () => {
        const key = localStorage.getItem("openai_api_key");
        if (key) {
          apiKeyInput.value = key;
          alert("âœ… å·²è¼‰å…¥å„²å­˜çš„ API Key");
        } else {
          alert("âš ï¸ æ²’æœ‰å„²å­˜çš„ API Key");
        }
      });

      document.getElementById("toggleKey").addEventListener("click", () => {
        apiKeyInput.type =
          apiKeyInput.type === "password" ? "text" : "password";
      });

      // ====== ç¿»è­¯åŠ©æ‰‹ (åˆ†é–‹è«‹æ±‚) ======
      async function translate(text, target, lang) {
        const apiKey = apiKeyInput.value.trim();
        if (!apiKey) {
          alert("è«‹è¼¸å…¥ API Key");
          return;
        }
        if (!text) {
          alert("è«‹è¼¸å…¥æ–‡å­—");
          return;
        }

        target.value = "â³ ç¿»è­¯ä¸­...";

        try {
          const response = await fetch(
            "https://api.openai.com/v1/chat/completions",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${apiKey}`,
              },
              body: JSON.stringify({
                model: "gpt-4.1",
                messages: [
                  { role: "system", content: "You are a translator." },
                  {
                    role: "user",
                    content:
                      lang === "zh"
                        ? `è«‹å°‡ä»¥ä¸‹ç¹é«”ä¸­æ–‡ç¿»è­¯æˆç°¡é«”ä¸­æ–‡ï¼Œç›´æ¥è¼¸å‡ºæ–‡å­—å…§å®¹ï¼š\n${text}`
                        : `è«‹å°‡ä»¥ä¸‹ç¹é«”ä¸­æ–‡ç¿»è­¯æˆè‡ªç„¶æµæš¢çš„è‹±æ–‡ï¼Œç›´æ¥è¼¸å‡ºæ–‡å­—å…§å®¹ï¼š\n${text}`,
                  },
                ],
              }),
            }
          );

          const data = await response.json();
          if (data.error) {
            alert("âš ï¸ API éŒ¯èª¤: " + data.error.message);
            target.value = "";
            return;
          }
          target.value =
            data.choices?.[0]?.message?.content?.trim() || "âš ï¸ ç¿»è­¯å¤±æ•—";
        } catch (err) {
          alert("âš ï¸ è«‹æ±‚éŒ¯èª¤: " + err.message);
          target.value = "";
        }
      }

      document
        .getElementById("translateSimplifiedBtn")
        .addEventListener("click", () => {
          const text = document.getElementById("inputText").value.trim();
          const simplifiedText = document.getElementById("simplifiedText");
          translate(text, simplifiedText, "zh");
        });

      document
        .getElementById("translateEnglishBtn")
        .addEventListener("click", () => {
          const text = document.getElementById("inputText").value.trim();
          const englishText = document.getElementById("englishText");
          translate(text, englishText, "en");
        });

      // ====== Copy åŠŸèƒ½ ======
      function copyText(id) {
        const el = document.getElementById(id);
        el.select();
        document.execCommand("copy");
        alert("å·²è¤‡è£½å…§å®¹");
      }
    </script>
  </body>
</html>
